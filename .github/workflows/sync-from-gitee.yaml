name: Sync from Gitee
on:
  schedule:
    - cron: '*/5 * * * *'
  workflow_dispatch:

jobs:
  sync:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
        with:
          submodules: true
          fetch-depth: 0
          token: ${{ secrets.GH_PAT }}
      - name: Pull from Gitee
        run: |
          git remote add gitee https://${{ secrets.GITEE_TOKEN }}@gitee.com/liudegui/embedded-tech-articles.git || true
          git fetch gitee main
          CHANGES=$(git rev-list HEAD..gitee/main --count 2>/dev/null || echo "0")
          if [ "$CHANGES" -gt "0" ]; then
            git merge gitee/main --no-edit
            git push origin main
          else
            echo "Already up to date"
          fi
